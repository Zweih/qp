# Maintainer: Fernando Nunez <me@fernandonunez.io>
pkgname=yaylog
pkgver=2.2.4
pkgrel=1
pkgdesc="A CLI utility to list installed packages with filtering, written in Go."
arch=('x86_64' 'aarch64' 'armv7h')
url="https://github.com/Zweih/yaylog"
license=("MIT")
provides=('yaylog')
conflicts=('yaylog-git')

release_url="${url}/releases/download/v${pkgver}/yaylog"
ext=".tar.gz"

source_x86_64+=("${release_url}-x86_64${ext}")
source_aarch64+=("${release_url}-aarch64${ext}")
source_armv7h+=("${release_url}-armv7h${ext}")

sha256sums_x86_64=('86bf85adb609241c5266ec99d57608db5010cf152d9bf7fbaaa447e894fbafd8')
sha256sums_aarch64=('7baebe779d9576897406dfb84b3fe5f3970469c12e7a337e582759bf3ae382fc')
sha256sums_armv7h=('c2c3812b30afec21078df1db05532018555d068f6dc54b527631c88b0ba3e63a')

package() {
  tar -xzf "$srcdir/yaylog-${CARCH}${ext}" -C "$srcdir"

  install -Dm755 "$srcdir/yaylog-${CARCH}" "$pkgdir/usr/bin/yaylog"
  install -Dm644 "$srcdir/yaylog.1" "$pkgdir/usr/share/man/man1/yaylog.1"
}

post_upgrade() {
  previous_version=$1
  new_version=$2

  if [[ $(vercmp "$previous_version" "3.0.0") -lt 0 ]]; then
    echo "==> yaylog has been upgraded to a precompiled binary as of version 3.0.0."
    echo "==> If you prefer to build from source, please install the yaylog-git package."
  fi
}
